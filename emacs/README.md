[//]: # "THIS FILE IS GENERATED BY emacs-init.org."

[//]: # "IT SHOULD NOT BE MODIFIED DIRECTLY."

This repository contains the files that make up my Emacs setup.

For the moment, that is my (literate) Emacs initialisation file
and my `yankpad` file.


# Table of Contents

1.  [`emacs-init.org`](#org9bcede4)
    1.  [Introduction](#org0575384)
        1.  [Setting up `.emacs` to use this code](#orga581a41)
    2.  [Major packages](#org0327e52)
        1.  [Package repositories](#org870b94c)
        2.  [`agda` mode](#orgd988a1d)
        3.  [`org` mode](#org1061a43)
        4.  [`pdf-tools`](#orge2a9399)
        5.  [`yankpad` and `yasnippets`](#org1fa2144)
        6.  [`dired`](#org897a35f)
    3.  [Key bindings](#org68fb828)
        1.  [`general` definers](#org5bf3b69)
        2.  [`yankpad`](#org0541301)
        3.  [`dired`](#orgb9c3467)
        4.  [Navigation](#org0ca7b23)
        5.  [`magit`](#org2b41951)
        6.  [Other](#orgbfce016)
    4.  [Navigation](#org025c3d7)
        1.  [Jump between windows using `windmove`](#org17f5f91)
        2.  [Change scrolling (shortcut) behaviour](#org32c1b19)
    5.  [Cosmetics](#org0733311)
        1.  [Displaying/removing information and interface elements](#org49d2172)
        2.  [Themes](#org76b6654)
        3.  [Automatically revert unchanged files which change on the disk](#orgc4de085)
        4.  [Use `wordsmith` for English syntax highlighting](#orgf06363c)
        5.  [Show possible completions as I type shortcuts](#org2e5f142)
        6.  [Provide a visualisation of my undo tree](#org2482178)
        7.  [Buffers to open upon startup](#org3092e69)
    6.  [Other](#org670ed56)
        1.  [Run my custom “dropbox start” command to ensure dropbox is running on the system](#org9caad57)
    7.  [Generating the README.md for my Emacs repo](#org6e9cf9b)
2.  [`yankpad.org`](#orgb22fdba)
    1.  [Description](#org543241e)
        1.  [Introduction](#org00bff43)
        2.  [Organisation notes](#orgb0b01b6)
        3.  [Documentation links](#orgf0a4aa5)
        4.  [Caveats](#org4bd0d32)
    2.  [org-mode](#orgc31adf0)
        1.  [`org` blocks](#orge439bf0)
    3.  [Default](#orgfda4ecb):global:
        1.  [Punctuation, parentheses, etc.](#orgdd1c4d9)
        2.  [Words](#orgad74d02)
        3.  [Filepaths](#orgb4ccefb)
        4.  [Other global](#org375af7a)
    4.  [agda2-mode](#orgd5515b7)
        1.  [ag: Literate code block](#orgdaf62de):src:ag:
        2.  [ga: Break up a literate code block](#org514ec70):src:ga:
        3.  [tag: Catch-file-between-tags](#orge7c0c56):src:tag:
        4.  [fun: Function declaration with type signature](#org7d89a11):src:fun:
        5.  [dt: Datatype declaration](#orgc6dca0f):src:dt:
        6.  [setl: `Set` arguments parameterised by a `Level`](#org91f37e3):src:setl:
        7.  [isetl: *Implicit* `Set` arguments parameterised by a `Level`](#org368a8c6):src:isetl:
        8.  [2setl: `Set` arguments parameterised by two `Level's`](#orga27bf87):src:2setl:
        9.  [i2setl: *Implicit* `Set` arguments parameterised by two `Level's`](#orgb26b616):src:i2setl:
        10. [with: `with` pattern](#org50187ef):src:with:
        11. [eqr: Start a `≡-Reasoning` block](#org5b449ce):src:eqr:
        12. [eqs: Insert a step in a `≡-Reasoning` block](#org0178d3b):src:eqs:
    5.  [tex-mode](#orge785b18)
        1.  [leg: General LaTeX environment](#org6c977bc):src:leg:
        2.  [lei: LaTeX itemize](#orgd49376a):src:lei:
        3.  [lec: LaTeX center](#orgf5b14b8):src:lec:
        4.  [li: LaTeX item](#org734134a):src:li:
        5.  [cfbt: Import a tagged portion of another file](#org3e2d397):src:li:


<a id="org9bcede4"></a>

# `emacs-init.org`



<a id="org0575384"></a>

## Introduction

This is my `emacs` initialisation code, documented for my own understanding
in the future and for sharing with others.

I'm following [Musa's](https://alhassy.github.io/init/) example using an `org` file for this.


<a id="orga581a41"></a>

### Setting up `.emacs` to use this code

Create a symbolic link to this file in `~/.emacs.d/~,
then add to the bottom of =~/.emacs` these lines:

    ;; BEGIN my edits
    
    ;; I've set up an init file following Musa's guide: https://alhassy.github.io/init/
    
    ;; Enable Emacs VC on symlinked files
    (setq vc-follow-symlinks t)
    
    ;; Evaluate my init file.
    (org-babel-load-file "~/.emacs.d/emacs-init.org")
    
    ;; Byte compile the file so that changes to emacs-init.org get picked up.
    (byte-compile-file "~/.emacs")
    
    ;; END my edits

1.  Why set `vc-follow-symlinks` here?

    It's a setting I want anyway (it ensures Emacs's version control
    works correctly on the target file), but why set it in `.emacs`?
    
    Since `.emacs` uses a symlink to this version controlled file,
    having Emacs prompt me every time is annoying and slows my start up.


<a id="org0327e52"></a>

## Major packages


<a id="org870b94c"></a>

### Package repositories

    (require 'package)
    (setq package-archives
       '(("melpa" . "https://melpa.org/packages/")
         ("gnu" . "https://elpa.gnu.org/packages/")
         ("org" . "http://orgmode.org/elpa/")))
    (package-initialize)

1.  Set the load path for manually downloaded packages

    (Currently I don't use manually downloaded packages)
    
        ;;(add-to-list 'load-path "~/Dropbox/Organisation/setup/emacs/downloaded-packages")


<a id="orgd988a1d"></a>

### `agda` mode

We need Emacs to locate Agda mode. This command is put in `.emacs`

    (load-file (let ((coding-system-for-read 'utf-8))
                    (shell-command-to-string "agda-mode locate")))

    (require 'agda-input)
    (require 'agda2-highlight)

1.  Command line arguments

    Dr. Wolfram Kahl has recommended customising the following settings.
    (note that my machine is a virtual machine running on a Chromebook
    with a little less than `5G` available to it).
    
        (setq agda2-program-args (quote ("+RTS" "-M3G" "-H3G" "-A128M" "-RTS")))
    
    These arguments specify
    
    <table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
    
    
    <colgroup>
    <col  class="org-left" />
    
    <col  class="org-left" />
    </colgroup>
    <tbody>
    <tr>
    <td class="org-left">`+RTS`, `-RTS`</td>
    <td class="org-left">Flags between these are arguments to the `ghc` runtime</td>
    </tr>
    
    
    <tr>
    <td class="org-left">`-M[size]`</td>
    <td class="org-left">Maximum heap size</td>
    </tr>
    
    
    <tr>
    <td class="org-left">`-H[size]`</td>
    <td class="org-left">Suggested heap size</td>
    </tr>
    
    
    <tr>
    <td class="org-left">`-A[size]`</td>
    <td class="org-left">Allocation area size used by the garbage collector</td>
    </tr>
    </tbody>
    </table>
    
    Full documentation for the `ghc` runtime argumentscan be found [here](https://downloads.haskell.org/~ghc/7.8.4/docs/html/users_guide/runtime-control.html).
    
    Additional arguments that may be useful include
    
    <table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
    
    
    <colgroup>
    <col  class="org-left" />
    
    <col  class="org-left" />
    </colgroup>
    <tbody>
    <tr>
    <td class="org-left">`-S[file]`</td>
    <td class="org-left">Produces information about “each and every garbage collection”</td>
    </tr>
    
    
    <tr>
    <td class="org-left">&#xa0;</td>
    <td class="org-left">- Outputs to `stderr` by default</td>
    </tr>
    </tbody>
    </table>

2.  Alternative problem highlighting

    I find the background coloring used by Agda for incomplete pattern matching,
    redundant clauses and clauses which do not hold definitionally hard to read
    in general, and usually unreadable with different themes.
    
    So I use set other indicators instead.
    
        (defun my-agda-highlighting ()
          "Set face attributes to replace Agda highlighting I find annoying."
          (set-face-attribute
            'agda2-highlight-coverage-problem-face
            nil ;; all frames
            :background nil
            :underline "dark red"
          )
          (set-face-attribute
            'agda2-highlight-deadcode-face
            nil ;; all frames
            :background nil
            :strike-through t
          )
          (set-face-attribute
            'agda2-highlight-catchall-clause-face
            nil ;; all frames
            :background nil
            :slant 'italic
          )
        )
        
        (add-hook 'agda2-mode-hook 'my-agda-highlighting)

3.  Add unicode characters to Agda's translations

    1.  Punctuation and parentheses
    
            (add-to-list 'agda-input-user-translations '(";;" "﹔"))
            (add-to-list 'agda-input-user-translations '(";;" "⨾"))
            (add-to-list 'agda-input-user-translations '("|" "❙"))
            (add-to-list 'agda-input-user-translations '("st" "•"))
            (add-to-list 'agda-input-user-translations '("{" "｛"))
            (add-to-list 'agda-input-user-translations '("}" "｝"))
            (add-to-list 'agda-input-user-translations '("{" "⁅"))
            (add-to-list 'agda-input-user-translations '("}" "⁆"))
    
    2.  Correct mistakes on subscripts/superscripts
    
        I often accidentally hold the shift key for too long when entering
        subscripts and superscripts; these translations account for that.
        
            (add-to-list 'agda-input-user-translations '("^!" "¹"))
            (add-to-list 'agda-input-user-translations '("^@" "²"))
            (add-to-list 'agda-input-user-translations '("^#" "³"))
            (add-to-list 'agda-input-user-translations '("^$" "⁴"))
            (add-to-list 'agda-input-user-translations '("^%" "⁵"))
            (add-to-list 'agda-input-user-translations '("^^" "⁶"))
            (add-to-list 'agda-input-user-translations '("^&" "⁷"))
            (add-to-list 'agda-input-user-translations '("^*" "⁸"))
            (add-to-list 'agda-input-user-translations '("^(" "⁹"))
            (add-to-list 'agda-input-user-translations '("^)" "⁰"))
            (add-to-list 'agda-input-user-translations '("_!" "₁"))
            (add-to-list 'agda-input-user-translations '("_@" "₂"))
            (add-to-list 'agda-input-user-translations '("_#" "₃"))
            (add-to-list 'agda-input-user-translations '("_$" "₄"))
            (add-to-list 'agda-input-user-translations '("_%" "₅"))
            (add-to-list 'agda-input-user-translations '("_^" "₆"))
            (add-to-list 'agda-input-user-translations '("_&" "₇"))
            (add-to-list 'agda-input-user-translations '("_*" "₈"))
            (add-to-list 'agda-input-user-translations '("_(" "₉"))
            (add-to-list 'agda-input-user-translations '("_)" "₀"))
    
    3.  Activate the new additions
    
            (agda-input-setup)

4.  Activate Agda input mode in `text` and `prog` modes

        (add-hook 'text-mode-hook
               (lambda () (set-input-method "Agda")))
        (add-hook 'prog-mode-hook
               (lambda () (set-input-method "Agda")))


<a id="org1061a43"></a>

### `org` mode

    (require 'org)
    (require 'ox-extra)

1.  Capture

    I'm beginning to use `org-capture` to enable me to log
    ideas/TODO items from anywhere in Emacs in my log file.
    
        (setq org-default-notes-file "~/Dropbox/Organisation/log/log.org")
    
    Currently I just use the default capture template,
    and manually organise ideas later.
    Once I use this system for a while,
    I should ideally set up other templates to automate some of this.

2.  Agenda

    My log file is my agenda.
    
        (setq org-agenda-files '("~/Dropbox/Organisation/log/log.org"))

3.  Speed keys

    Speed keys are single keystrokes which execute commands in an
    `org` file when the cursor is at the start of a headline.
    
        (setq org-use-speed-commands t)
    
    To see the commands available, execute
    
        (org-speed-command-help)

4.  Exporting

    1.  Allow for ignoring headlines and/or subtrees
    
        Use the `:ignore:` tag on headlines to omit the headline when
        exporting, but keep its contents.
        
            (ox-extras-activate '(ignore-headlines))
        
        Alternatively, use the `:noexport:` tag to omit the headline
        *and* its contents.
        
            ;;;; noexport is in the list by default
            ;; (add-to-list 'org-export-exclude-tags "noexport")
    
    2.  Source code block indentation and colouring
    
        I want to preserve my indentation for source code during export.
        
            (setq org-src-preserve-indentation t)
        
        The `htmlize` package preserves source code colouring on export to html.
        (And presumably does a lot more I am not fully aware of).
        
            (require 'htmlize)
    
    3.  Export in the background
    
        Using `latex-mk`, the export process takes a bit of time.
        Tying up emacs during that time is annoying, so set the
        export to happen in the background.
        
            ;;(setq org-export-in-background t)
        
        This works by spawning a new Emacs session.
        That session needs an init file, which by default would be this file;
        for several reasons, though, I don't want it to use this file.
        Chief among them, I split the frame in this init file,
        and having no actual frame, this causes an error for the export process.
        
            ;;(setq org-export-async-init-file "~/Dropbox/Organisation/setup/emacs/org-export-init.el")
        
        This elisp code creates that init file,
        based on an [answer on StackExchange](https://superuser.com/a/898717/1032497).
        
        Unfortunately, at the moment, this doesn't quite work for me,
        because I need all my other export settings set as well.
        So I've disabled exporting in the background for now.
        
            (with-temp-file
              "~/Dropbox/Organisation/setup/emacs/org-export-init.el"
              (insert "(require 'package)
                       (setq package-enable-at-startup nil)
                       (package-initialize)
            
                       (require 'org)
                       (require 'ox)
                       (require 'cl)
                       (setq org-export-async-debug nil)
              ")
            )
    
    4.  LaTeX specific
    
        1.  Default LaTeX compiler
        
            I use a lot of unicode, and I find `xelatex` and `lualatex`
            handle that more easily than `pdflatex`.
            
            From my experience so far, they seem pretty interchangable
            for my purposes, so the decision of which to use is arbitrary.
            
            Based on [this discussion on Stack Exchange](https://tex.stackexchange.com/questions/36/differences-between-luatex-context-and-xetex), LuaTeX seems the more
            “up and coming” engine, so I'm using it at least until something breaks.
            
                (setq org-latex-compiler "lualatex")
        
        2.  LaTeX compilation process
        
            I use `latexmk` to automatically run as many passes as needed
            to resolve references, etc.
            
                (setq org-latex-pdf-process
                      '("latexmk -%latex -f %f"))
            
            The flags/format specifiers are
            
            <table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
            
            
            <colgroup>
            <col  class="org-left" />
            
            <col  class="org-left" />
            </colgroup>
            <tbody>
            <tr>
            <td class="org-left">`%latex`</td>
            <td class="org-left">stands in for the latex compiler (defaults to the setting above)</td>
            </tr>
            
            
            <tr>
            <td class="org-left">`-f`</td>
            <td class="org-left">force continued processing past errors</td>
            </tr>
            
            
            <tr>
            <td class="org-left">`%f`</td>
            <td class="org-left">stands in for the (relative) filename</td>
            </tr>
            </tbody>
            </table>
            
            Other flags/format specifiers I may wish to add later include
            
            <table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
            
            
            <colgroup>
            <col  class="org-left" />
            
            <col  class="org-left" />
            </colgroup>
            <tbody>
            <tr>
            <td class="org-left">`-shell-escape`</td>
            <td class="org-left">necessary to use `minted`</td>
            </tr>
            </tbody>
            </table>
        
        3.  Custom document classes
        
            I want a `report` class that begins with `chapter`'s, rather than
            `part`'s.
            
                (add-to-list
                  'org-latex-classes
                    '("report-noparts"
                      "\\documentclass{report}"
                      ("\\chapter{%s}" . "\\chapter*{%s}")
                      ("\\section{%s}" . "\\section*{%s}")
                      ("\\subsection{%s}" . "\\subsection*{%s}")
                      ("\\subsubsection{%s}" . "\\subsubsection*{%s}")
                      ("\\paragraph{%s}" . "\\paragraph*{%s}")
                      ("\\subparagraph{%s}" . "\\subparagraph*{%s}")))
            
            Sometimes, for creating slides, `beamer` is useful.
            (Though I try to avoid it now; it feels low level to me).
            
                (add-to-list
                  'org-latex-classes
                    '("beamer"
                      "\\documentclass[presentation]{beamer}"
                      ("\\section{%s}" . "\\section*{%s}")
                      ("\\subsection{%s}" . "\\subsection*{%s}")
                      ("\\subsubsection{%s}" . "\\subsubsection*{%s}")))
        
        4.  Source code colouring in LaTeX exports
        
            We can use `minted` for source code colouring on export to LaTeX.
            
            Currently this breaks things with my literate Agda process,
            a problem I should resolve. For the moment, if I want to use
            `minted`, I can do so on a file-by-file basis.
            
            ⟪ `pygments` (also called `python-pygments`) must be installed on the
              system for this to work. ⟫
            
                ;;(setq org-latex-listings 'minted
                ;;      org-latex-packages-alist '(("" "minted")))

5.  Evaluating code

    By default, Emacs will query whether we *actually* want to
    execute code when we evaluate a code block. Also, it seems to
    just *not* execute code marked for execution during export in an
    `org` file. So, I remove the safety.
    
        (setq org-confirm-babel-evaluate nil)
    
    Loading the following languages with `require` allows code blocks
    in them to be evaluated.
    
    By default only emacs lisp can be evaluated.
    
    Documentation [here](https://orgmode.org/manual/Languages.html).
    
        (require 'ob-C)
        (require 'ob-haskell)
        (require 'ob-latex)
        (require 'ob-shell)
        (require 'ob-ruby)
    
    For shell code, we need to initialise via this function.
    See [here](https://emacs.stackexchange.com/questions/37692/how-to-fix-symbols-function-definition-is-void-org-babel-get-header).
    
        (org-babel-shell-initialize)

6.  Cosmetics

    1.  Indent text based on heading
    
            (setq org-indent-mode t)
    
    2.  Hide emphasis markers by default
    
            (setq org-hide-emphasis-markers t)
    
    3.  Highlight math mode blocks
    
            (setq org-highlight-latex-and-related '(latex))


<a id="orge2a9399"></a>

### `pdf-tools`

Need to “install” it each time emacs starts

    (pdf-tools-install)


<a id="org1fa2144"></a>

### `yankpad` and `yasnippets`

I use `yasnippets` for text expansion, and `yankpad` to organise my
snippets.

    (require 'yasnippet)
    (yas-global-mode t)
    
    (require 'yankpad)
    (setq yankpad-file "~/Dropbox/Organisation/setup/emacs/yankpad.org")

`yas-wrap-around-region` controls what is inserted for a snippet's
`$0` field. A non-nil, non-character setting has it insert the
current region's contents (i.e. if we highlight a region and
invoke a snippet, the region will be wrapped).

    (setq yas-wrap-around-region t)

`yas-indent-line` controls how inserted snippets are inserted.
`fixed` indicates the snippet should be indented to the column at point.
`auto` instead causes each line to be indented using `indent-according-to-mode`.
I set it to fixed because this is usually what I want; I know best, not the mode.

    (setq yas-indent-line 'fixed)

1.  Don't add a final newline when editing snippet files

    `yasnippets` will insert the final newline when expanding a snippet,
    so snippet files generally shouldn't include a final newline.
    
        (add-hook 'snippet-mode-hook (setq require-final-newline nil))


<a id="org897a35f"></a>

### `dired`

I use `dired` for browsing directories; it's simple, and with
the right configuration, very easy to use.

1.  Display preferences

    `dired` makes use of switches for `ls`.
    
    I like the following switches:
    
    <table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
    
    
    <colgroup>
    <col  class="org-left" />
    
    <col  class="org-left" />
    </colgroup>
    <tbody>
    <tr>
    <td class="org-left">`--group-directories-first`</td>
    <td class="org-left">group directories before files</td>
    </tr>
    
    
    <tr>
    <td class="org-left">`-a`</td>
    <td class="org-left">do not ignore entries starting with .</td>
    </tr>
    
    
    <tr>
    <td class="org-left">`-B`</td>
    <td class="org-left">do not list implied entries ending with ~</td>
    </tr>
    
    
    <tr>
    <td class="org-left">`-g`</td>
    <td class="org-left">long listing format, but do not list owner</td>
    </tr>
    
    
    <tr>
    <td class="org-left">`-G`</td>
    <td class="org-left">in a long listing, don't print group names</td>
    </tr>
    
    
    <tr>
    <td class="org-left">`-h`</td>
    <td class="org-left">print human readable size</td>
    </tr>
    
    
    <tr>
    <td class="org-left">`-L`</td>
    <td class="org-left">show information for *references* rather than symbolic links</td>
    </tr>
    </tbody>
    </table>
    
        (setq dired-listing-switches "--group-directories-first -aBgGhL")

2.  Use only one buffer for `dired`

    I use `dired-single` to avoid `dired` opening a new buffer
    for every directory visited.
    
        (require 'dired-single)
    
    I use a “magic” buffer with the name `*Dired*`, to avoid the single
    `dired` buffer being named after whatever directory I first visit.
    
        (setq dired-single-use-magic-buffer t)
        (setq dired-single-magic-buffer-name "*Dired*")
    
    The below code, which rebinds keys to use `dired-single` rather than `dired`,
    is taken directly from the `dired-single` [GitHub readme](https://github.com/crocket/dired-single).
    
        (defun my-dired-init ()
          "Bunch of stuff to run for dired, either immediately or when it's
           loaded."
          ;; <add other stuff here>
          (define-key dired-mode-map [return] 'dired-single-buffer)
          (define-key dired-mode-map [mouse-1] 'dired-single-buffer-mouse)
          (define-key dired-mode-map "." 'dired-single-up-directory)
        )
        
        ;; if dired's already loaded, then the keymap will be bound
        (if (boundp 'dired-mode-map)
                ;; we're good to go; just add our bindings
                (my-dired-init)
          ;; it's not loaded yet, so add our bindings to the load-hook
          (add-hook 'dired-load-hook 'my-dired-init))


<a id="org68fb828"></a>

## Key bindings

I make use of `hydra` for keybindings (or groups of keybindings)
which will be executed several times in a row.

I also make use of `general` to organise other keybindings.

    (require 'general)


<a id="org5bf3b69"></a>

### `general` definers

You can use `general-define-key` directly to define shortcuts,
ideally using the keyword argument `:prefix` to avoid repeating
prefixes, but if you are (even only possibly)
using a prefix several times,
it's better to create a custom function to use instead of
`general-define-key`.

Setting `:keymaps` to `'override` ensures that no package will
override my shortcuts.

For the moment, I'm experimenting with using `s`-key (“super”-key)
combinations as prefixes. I have my caps lock bound to super
(on my Chromebook's internal keyboard it's bound to that by
default), and I think if I restrict the combination keys to
those on the left side of the keyboard, I can avoid “Emacs pinky”.

So far I have three categories of shortcuts:

-   My main shortcuts, those that don't fall into another category.
-   Shortcuts to navigate around the current buffer.
-   Shortcuts to open a `dired` buffer for a certain folder.

    (general-create-definer general-main-define-key
      :prefix "s-a"
      :keymaps 'override)
    
    (general-create-definer general-buf-nav-define-key
      :prefix "s-w"
      :keymaps 'override)
    
    (general-create-definer general-dired-define-key
      :prefix "s-d"
      :keymaps 'override)


<a id="org0541301"></a>

### `yankpad`

I use a non-prefixed shortcut for snippet expansion, since
I do it all the time.
(at least until yankpad has smart tab expansion).

    (general-define-key
      "s-f" 'yankpad-expand)

Alternatively, `y m` invokes `yankpad-map`, which brings up a
keymap of the last tags of snippets.

    (general-main-define-key
      "y m" 'yankpad-map)

Changes to the yankpad file require `yankpad-reload` to be run
to re-cache the snippets. For the moment, it seems like there is
separate caching for each buffer, meaning this command has to be
run in every buffer where I want changes to be picked up.
So, I have a shortcut key.

    (general-main-define-key
      "y r" 'yankpad-reload)


<a id="orgb9c3467"></a>

### `dired`

I use shortcuts to jump to frequently used directories in `dired`
(from any buffer, not just while in `dired`).

As seen in `Cosmetics`, I use `dired-single` in order to only have one
`dired` buffer at a time. In case this changes, I define another
local variable to store the command to invoke `dired` with.

    (defun my-dired-invocation (directory)
      "My custom dired invocation.
       It will use my special “magic buffer” for browsing."
      (dired-single-magic-buffer directory))

    (general-dired-define-key
      "h" '((lambda () (interactive)
              (my-dired-invocation "~"))
            :which-key "Home")
      "o" '((lambda () (interactive)
              (my-dired-invocation "~/Dropbox/Organisation/"))
            :which-key "Organisation")
      "p" '((lambda () (interactive)
              (my-dired-invocation "~/Dropbox/Projects/"))
            :which-key "Projects")
      "m" '((lambda () (interactive)
              (my-dired-invocation "~/Dropbox/McMaster/"))
            :which-key "McMaster")
      "t" '((lambda () (interactive)
              (my-dired-invocation "~/Dropbox/McMaster/Agda/thesis/"))
            :which-key "Thesis")
      "e" '((lambda () (interactive)
              (my-dired-invocation "~/Dropbox/McMaster/3ea3/"))
            :which-key "3ea3")
    )


<a id="org0ca7b23"></a>

### Navigation

    (general-buf-nav-define-key
      "r" (lambda () (interactive) (revert-buffer () t ()))
      "u" (lambda () (interactive) (undo-tree-visualize))
      "b" (lambda () (interactive) (beginning-of-buffer))
      "e" (lambda () (interactive) (end-of-buffer))
      "t t" (lambda () (interactive) (toggle-my-themes))
      "t c" (lambda () (interactive) (disable-all-custom-themes))
      "<right>" (lambda () (interactive) (windmove-right))
      "<left>" (lambda () (interactive) (windmove-left))
      "<up>" (lambda () (interactive) (windmove-up))
      "<down>" (lambda () (interactive) (windmove-down))
    )


<a id="org2b41951"></a>

### `magit`

    (general-main-define-key
      "g" 'magit-status
    )


<a id="orgbfce016"></a>

### Other

    (general-main-define-key
      "j" 'dad-joke
    )


<a id="org025c3d7"></a>

## Navigation


<a id="org17f5f91"></a>

### Jump between windows using `windmove`

The package `windmove` lets us jump between windows in a frame.

    (require 'windmove)

For the uninitiated, a *window* in Emacs is not the same as
the OS window. Each OS window is a *frame*, and each pane within
a frame is called a *window*. (Emacs predates modern terminology).

`windmove` lets us move between windows with the arrow keys
while holding a key; by default, the key is `shift`.
That conflicts with `org` though, so we could use
`windmove-default-keybindings` to change it.

Unfortunately, on my system, all the other possibilities seem
to be taken with system shortcuts (which I cannot modify in ChromeOS),
or otherwise taken in Emacs.

So instead I've define shortcuts using `general` above.


<a id="org32c1b19"></a>

### Change scrolling (shortcut) behaviour

I find the scrolling shortcuts `scroll-up-command` (`C-v`)
and `scroll-down-command` (`M-v`) “too aggressive”.
They scroll the screen by nearly the whole window height,
by default leaving visible only 2 lines which were visible.

I find adjusting this upwards makes it easier to follow along
with a document as scrolling.

    (setq next-screen-context-lines 16)

Keep in mind `recenter` (`C-l`) when scrolling this way to recenter
the screen on the current line.


<a id="org0733311"></a>

## Cosmetics


<a id="org49d2172"></a>

### Displaying/removing information and interface elements

There are several tweaks I like to display important information
and hide unimportant information or interfact elements.

1.  Remove unnecessary interface elements

    Emacs usually shows a splash screen on startup,
    which doesn't interest me.
    
        (setq inhibit-splash-screen t)
    
    I don't use the tool bar (icons below the menu bar).
    (This setting must be `-1`, not `()`).
    
        (tool-bar-mode -1)
    
    I also don't use the menu bar.
    (Again, this must be `-1`, not `()`).
    
        (menu-bar-mode -1)
    
    I also disable the scroll bars.
    
        (scroll-bar-mode -1)

2.  Prompts for important things

    I rarely *actually* want to close Emacs, so it should always
    prompt if I accidentally ask to close.
    
        (setq confirm-kill-emacs 'yes-or-no-p)

3.  Information in the mode line

    The doom themes package comes with a function to make
    the mode line flash on error.
    
        (doom-themes-visual-bell-config)
    
    I'd previously just used `visible-bell`, but it's a bit nosier
    than necessary.
    
        ;;(setq visible-bell t)
    
    I also like the mode line to show the data and time.
    
        (setq display-time-day-and-date t)
        (setq display-time-24h-format t)
        (display-time)
    
    It's also useful to see the line number and column number.
    
        (line-number-mode t)
        (column-number-mode t)
    
    1.  Diminish minor mode names
    
        I use a lot of minor modes, so the mode list takes up a lot
        of space on the mode line.
        
        `diminish-mode` alleviates this by allowing us to hide modes
        or give them shorter names.
        
            (require 'diminish)
        
        I don't need to see that these modes are active.
        
            (eval-after-load "yas-minor-mode" '(diminish 'yas-minor-mode))
            (eval-after-load "yasnippet" '(diminish 'yas-minor-mode))
            (eval-after-load "undo-tree" '(diminish 'undo-tree-mode))
            (eval-after-load "which-key" '(diminish 'which-key-mode))
            (eval-after-load "org-indent" '(diminish 'org-indent-mode))
        
        If later I want to rename modes, just add a string argument
        to the above form with a (presumably shorter) name.

4.  Show line numbers on left (for `text` and `prog` mode)

    I like to have line numbers displayed, but `linum-mode`
    conflicts with `pdf-tools`. So instead of `global-linum-mode`,
    I enable it for `text` and `prog` modes.
    
        (add-hook 'text-mode-hook 'linum-mode)
        (add-hook 'prog-mode-hook 'linum-mode)

5.  Highlight matching parenthesis when cursor is near

        (load-library "paren")
        (show-paren-mode 1)
        (transient-mark-mode t)
        (require 'paren)

6.  Show trailing whitespace

    It's good style not to have trailing whitespace.
    `show-trailing-whitespace` will colour any trailing whitespace.
    
        (setq show-trailing-whitespace t)
    
    This can be a little annoying, so I should add a way to turn
    it off.
    
    1.  TODO toggle show-trailing-whitespace

7.  Show ruler at 80 characters for (for `text` and `prog` mode)

    It's also good style to keep lines under 80 characters wide.
    `fill-column-indicator` will display a line (by default at 70 characters)
    
    One thing worth noting is that with `org-indent-mode`,
    the line will be off by the length of the indentation
    (i.e. it will be at line 68 if indented 2 characters,
    66 if indented 4, etc.).
    
    The code to make it a global mode is from the [Emacs wiki](https://www.emacswiki.org/emacs/FillColumnIndicator).
    
        ;;(require 'fill-column-indicator)
        ;;(define-globalized-minor-mode global-fci-mode fci-mode (lambda () (fci-mode t)))
        ;;(global-fci-mode t)
    
    If I later need it enabled only for certain modes,
    this code could be of use.
    
        ;; (require 'fill-column-indicator)
        ;; (add-hook 'text-mode-hook 'fci-mode)
        ;; (add-hook 'prog-mode-hook 'fci-mode)

8.  Wrap lines

    Since I make an effort to keep my lines under 80 characters,
    I usually won't have lines too long for the window.
    
    If there are such lines, though, horizontally scrolling is
    annoying (or at least I find it so in Emacs).
    
    `visual-line-mode` will “wrap” lines which are too long.
    
        (global-visual-line-mode t)
    
    This can be annoying if working with a file with lots of long
    lines, so I should add a way to turn it off.
    
    1.  TODO toggle visual-line-mode


<a id="org76b6654"></a>

### Themes

I use the `doom-nord` themes,
and toggle between the non-`light` and `light` variants.

    (load-theme 'doom-nord t)
    
    (setq my-dark-theme 'doom-nord)
    (setq my-light-theme 'doom-nord-light)
    
    (defun disable-all-custom-themes ()
      "Disable all custom themes.
       Returns the previous highest precendence theme
       (nil if no themes were previously enabled).
    
       Implementation:
         Gets the highest precedence applied theme as the first element
         of custom-enabled-themes.
    
         Then iteratively disables all the themes in custom-enabled-themes.
      "
      (let ((most-recent-theme (car custom-enabled-themes)))
        (while (car custom-enabled-themes)
          (disable-theme (car custom-enabled-themes)))
        most-recent-theme
      )
    )
    
    (defun toggle-my-themes ()
      "Disable all custom, then try to toggle the themes
       my-dark-theme and my-light-theme, in that if one was
       the last applied theme, the other will be applied.
    
       If neither was the last applied theme, my-dark-theme
       will be applied as a default.
      "
    
      (let ((most-recent-theme (disable-all-custom-themes)))
        (if (eq most-recent-theme my-dark-theme)
            (load-theme my-light-theme)
            (load-theme my-dark-theme)
        )
      )
    )
    
    (eq (car custom-enabled-themes) my-dark-theme)
    (disable-all-custom-themes)
    (toggle-my-themes)

Make it “play nice” with `org`

    (doom-themes-org-config)


<a id="orgc4de085"></a>

### Automatically revert unchanged files which change on the disk

    (global-auto-revert-mode t)


<a id="orgf06363c"></a>

### TODO Use `wordsmith` for English syntax highlighting

    (require 'wordsmith-mode)


<a id="org2e5f142"></a>

### Show possible completions as I type shortcuts

    (require 'which-key)
    (which-key-mode)


<a id="org2482178"></a>

### Provide a visualisation of my undo tree

In Emacs, changes to a buffer are stored using a tree,
rather than a stack.

In most editors if we revert to an earlier state using “undo”
and then make some changes, we can no longer reach the
state *before* the “undo”, because it was popped of the stack
and is now lost (the “redo” stack was lost when we made changes).

This doesn't happen with an “undo tree”!

I like to think of the undo tree as “extemely local” version control.

The package `undo-tree` provides a visualisation of the undo tree.

    (require 'undo-tree)
    (global-undo-tree-mode)

I like each node in the undo tree to have a timestamp;
it helps identify the node I want to return to.

    (setq undo-tree-visualizer-timestamps t)

We can have a “diff” window display the changes made at each
node in the undo tree.

Unfortunately this seems to introduce a fair amount of lag
on my system.

    ;;(setq undo-tree-visualizer-diff ())


<a id="org3092e69"></a>

### Buffers to open upon startup

Note that this portion of the file should be *after* any settings
that would affect these buffers.

Otherwise those settings will not apply in these buffers.

I like a bunch of files open upon startup.

    (find-file "~/Dropbox/Organisation/setup/emacs/tips-and-tricks.org")
    (find-file "~/Dropbox/Organisation/setup/emacs/yankpad.org")
    (find-file "~/Dropbox/McMaster/Agda/scratch.agda")
    (find-file "~/Dropbox/Organisation/log/phone-log.org")

These last files are the ones I want “in focus” upon startup.

    (find-file "~/Dropbox/Organisation/setup/emacs/emacs-init.org")
    (split-window-right)
    (other-window 1)
    (find-file "~/Dropbox/Organisation/log/log.org")


<a id="org670ed56"></a>

## Other


<a id="org9caad57"></a>

### Run my custom “dropbox start” command to ensure dropbox is running on the system

    (start-process-shell-command "dropbox-start"
                                 "*dropbox-start*"
                                 "/opt/dropbox-filesystem-fix/dropbox_start.py")


<a id="org6e9cf9b"></a>

## Generating the README.md for my Emacs repo

This code generates a `README.md` file for my Emacs repo,
including this file and other relevant files.

    (with-temp-buffer
      (insert "#+EXPORT_FILE_NAME: README.md
               #+TITLE: My Emacs setup
               #+OPTIONS: toc:nil
    
               # HTML comments:
               [//]: # \"THIS FILE IS GENERATED BY emacs-init.org.\"
    
               [//]: # \"IT SHOULD NOT BE MODIFIED DIRECTLY.\"
    
               This repository contains the files that make up my Emacs setup.
    
               For the moment, that is my (literate) Emacs initialisation file
               and my ~yankpad~ file.
    
               #+TOC: headlines 3\n")
      (insert "* ~emacs-init.org~\n")
      (insert "#+INCLUDE: emacs-init.org\n")
      (insert "* ~yankpad.org~\n")
      (insert "#+INCLUDE: yankpad.org\n")
      (org-mode)
      (org-md-export-to-markdown)
    )


<a id="orgb22fdba"></a>

# `yankpad.org`



<a id="org543241e"></a>

## Description


<a id="org00bff43"></a>

### Introduction

This `org-mode` file contains commonly repeated snippets of text
which I expand using `yankpad` along with `yasnippets`.

Specifically, `yankpad` caches the snippets defined in this file,
and allows them to be expanded from a keyword with `yankpad-expand`
or selected from a keymap with `yankpad-map`.

With `yasnippets` installed (and its minor-mode active),
the contents of the snippets are actually executed using `yasnippets`,
which provides a great deal of functionality, including tab fields
and arbitrary lisp code execution.


<a id="orgb0b01b6"></a>

### Organisation notes

The outermost headings of this file separate it into *categories*.
Snippets in a category named after a mode are available
for yanking when that mode is active.
Other category's snippets can be made available by switching to that
category with `yankpad-set-category`.
Snippets in categories marked `:global:` are always available.

Inside categories, I use subheadings to organise snippets.
The *lowest level* headings define individual snippets.

Headings of snippets have the form `expandkeys: Name :settings:key:`,
where

-   `expandkeys` is a `:` separated list of keys for the snippet
    which can be expanded with `yankpad-expand`,
-   `Name` is the name of the snippet,
-   `settings` is `:` separated list of settings for the snippets,
    possibly including
    -   `src`, which marks the snippet as being literate; only the
        contents of code blocks in such snippets are inserted.
    -   `func`, which marks the snippet as a function. In this case
        no text is inserted; instead the code blocks of the snippet are
        executed.
    -   `results`, which acts like `func`, but in this case, the *results*
        of the code blocks inside the snippet
        are inserted.

Most of my snippets are marked `:src:`, since this *is* a literate file
(and I don't tend to use snippets for executing code).


<a id="orgf0a4aa5"></a>

### Documentation links

-   [yankpad](https://github.com/Kungsgeten/yankpad)
-   [yasnippets](https://github.com/joaotavora/yasnippet)
-   [org-mode](https://orgmode.org/) (for good measure)


<a id="org4bd0d32"></a>

### Caveats

Sometimes snippets seem to act oddly in this file;
specifically snippets from lower in the file won't
expand higher in the file (sometimes).

For that reason, the `org` mode snippets come first,
as they are useful for adding to this file.


<a id="orgc31adf0"></a>

## org-mode

I use `org` all the time, so you'll note in the `:properties:` drawer
that I include snippets from lots of other modes, since I often
write code from other modes in `org`.


<a id="orge439bf0"></a>

### `org` blocks

1.  `src` blocks

    Note that the `,#` expands to the `org` “comment” character `#`.
    
    This is needed to have a `#+end_src` *inside* a `src` block.
    
    1.  src: Generic source block     :src:orgsrc:
    
            #+begin_src $1
            $0
            #+end_src
    
    2.  el: Emacs lisp block     :src:orgel:
    
            #+begin_src emacs-lisp
            $0
            #+end_src
    
    3.  t: Plaintext     :src:orgt:
    
            #+begin_src text
            $0
            #+end_src
    
    4.  sh: Shell     :src:orgsh:
    
            #+begin_src shell
            $0
            #+end_src
    
    5.  ag: Agda code block     :src:orgag:
    
            #+begin_src org-agda
            $0
            #+end_src
    
    6.  ic: “Interactive” C block     :src:orgicc:
    
            #+begin_src c :tangle (currently-working-with "${1:generated}")
            $0
            #+end_src
    
    7.  icn: Inactive “Interactive” C block     :src:orgicn:
    
            #+begin_src c :tangle (not-currently-working-with "${1:generated}")
            $0
            #+end_src
    
    8.  ich: “Interactive” C header block     :src:orgich:
    
            #+begin_src c :tangle (currently-working-with-header "${1:generated}")
            $0
            #+end_src

2.  Blocks for LaTeX exports

    1.  ldisc: Discussion     :src:ldisc:
    
            #+attr_LaTeX: :options [$1]
            #+begin_discussion
            $0
            #+end_discussion

3.  Others

    1.  c: Center     :src:orgcntr:
    
            #+begin_center
            $0
            #+end_center
    
    2.  e: Example     :src:orgex:
    
            #+begin_example $1
            $0
            #+end_example
    
    3.  quot: Quote     :src:orgquot:
    
            #+begin_quote
            $0
            #+end_quote
    
    4.  ques: Question     :src:orgques:
    
            #+begin_example $1
            $0
            #+end_example
    
    5.  ans: Answer     :src:organs:
    
            #+begin_example $1
            $0
            #+end_example


<a id="orgfda4ecb"></a>

## Default     :global:

The category “Default” will be used if there is no category for the
current major mode.

I make these snippets available everywhere else as well by marking
the category as `:global:`.


<a id="orgdd1c4d9"></a>

### Punctuation, parentheses, etc.

1.  dq: Double quotes     :src:dq:

        “$1” $0

2.  card: Cardinality     :src:card:

        |$1| $0

3.  enc: Encoding     :src:enc:

        ⌜$1⌝ $0

4.  denc: Decoding     :src:denc:

        ⟦$1⟧ $0


<a id="orgad74d02"></a>

### Words

1.  det: deterministic     :src:

        deterministic

2.  ndet: non-deterministic     :src:

        non-deterministic


<a id="orgb4ccefb"></a>

### Filepaths

1.  Thesis

    1.  simp-dfa-tex:     :src:
    
            latex/Automata/Simple/DFA.tex


<a id="org375af7a"></a>

### Other global

1.  thisfile: Name of the current file (buffer)     :src:thisfile:

        `(buffer-name)`

2.  dasht: A “title” surrouned by dashes     :src:dasht:

        ${1:$(make-string (string-width yas-text) ?\-)}
        ${1:Title}
        ${1:$(make-string (string-width yas-text) ?\-)}
        $0
    
    Credit: the [[<http://joaotavora.github.io/yasnippet/snippet-development.html#orge2c1f71>][yasnippet tutorial

3.  dj: Get a dad joke     :src:dj:

        `(dad-joke)`

4.  yas: Yasnippet template     :src:yas:

    This should really move to a specialised category.
    
        # name: $1
        # key: $2
        # --
        $0


<a id="orgd5515b7"></a>

## agda2-mode


<a id="orgdaf62de"></a>

### ag: Literate code block     :src:ag:

    \begin{code}
    $0
    \end{code}


<a id="org514ec70"></a>

### ga: Break up a literate code block     :src:ga:

Often we need to break up code blocks somewhere in the middle.

The `\end{code}` here is an Elisp string so that it's not mistaken
as ending a LaTeX code environment in *this* document.

    `"\\end{code}"`
    $0
    \begin{code}


<a id="orge7c0c56"></a>

### tag: Catch-file-between-tags     :src:tag:

    %<*$1>
    $0
    %</$1>


<a id="org7d89a11"></a>

### fun: Function declaration with type signature     :src:fun:

    $1 : $0
    $1 = ?


<a id="orgc6dca0f"></a>

### dt: Datatype declaration     :src:dt:

    data $1 : Set where
      $2 : $1


<a id="org91f37e3"></a>

### setl: `Set` arguments parameterised by a `Level`     :src:setl:

    {${1:a} : Level} → (${2:A} : Set $1) → $0


<a id="org368a8c6"></a>

### isetl: *Implicit* `Set` arguments parameterised by a `Level`     :src:isetl:

    {${1:a} : Level} → {${2:A} : Set $1} → $0


<a id="orga27bf87"></a>

### 2setl: `Set` arguments parameterised by two `Level's`     :src:2setl:

    {${1:a} ${2:b} : Level} → (${3:A} : Set $1) → (${4:B} : Set $1) → $0


<a id="orgb26b616"></a>

### i2setl: *Implicit* `Set` arguments parameterised by two `Level's`     :src:i2setl:

    {${1:a} ${2:b} : Level} → {${3:A} : Set $1} → {${4:B} : Set $1} → $0


<a id="org50187ef"></a>

### with: `with` pattern     :src:with:

    with $1
    ... | ${2:thing} = $0


<a id="org5b449ce"></a>

### eqr: Start a `≡-Reasoning` block     :src:eqr:

    begin
      ?$0
    ≡⟨ ${1:?} ⟩
      ?
    ∎


<a id="org0178d3b"></a>

### eqs: Insert a step in a `≡-Reasoning` block     :src:eqs:

    ≡⟨ ${1:?} ⟩
      $0


<a id="orge785b18"></a>

## tex-mode


<a id="org6c977bc"></a>

### leg: General LaTeX environment     :src:leg:

    \begin{$1}
    $0
    \end{$1}


<a id="orgd49376a"></a>

### lei: LaTeX itemize     :src:lei:

    \begin{itemize}
    $0
    \end{itemize}


<a id="orgf5b14b8"></a>

### lec: LaTeX center     :src:lec:

    \begin{center}
    $0
    \end{center}


<a id="org734134a"></a>

### li: LaTeX item     :src:li:

    \item $0


<a id="org3e2d397"></a>

### cfbt: Import a tagged portion of another file     :src:li:

Using the package `catchfilebetweentags`.

    \ExecuteMetaData[$1]{$2}$0

